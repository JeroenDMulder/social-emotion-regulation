---
title: "Online supplementary materials"
description: |
  "Oh Behave! Individual differences in developmental trajectories  of social emotion regulation from childhood to emerging adolescence" by Achterberg, Mulder, Dobbelaar, Heunis, and Crone (2022)
date: December 13, 2022
author: 
  - name: Jeroen D. Mulder
    url: https://orcid.org/0000-0002-5553-0856
    affiliation: Utrecht University
    affiliation_url: https://www.uu.nl/staff/jdmulder
    orcid_id: 0000-0002-5553-0856
bibliography: references.bib
output: 
  distill::distill_article:
    toc: true
    toc_float: true
---

```{r setup, echo=FALSE}
library(tidyverse)
library(semTools)
library(haven) # Read in .sav files
library(naniar) # Missing data handling
library(ggplot2) # Data visualization
```

This document is the online supplement to "Oh behave! Individual differences in developmental trajectories of social emotion regulation from childhood to emerging adolescence" by Achterberg, Mulder, Dobbelaar, Heunis, and Crone (2022). It serves as a methodological and statistical rationale, and highlights the R-code that was used to fit the models and explore the results. It is organized as follows: First, the study design is summarized, and important characteristics of the data are highlighted. Second, the statistical analyses, which are organized according to the three aims of the project, are described. Finally, three sets of exploratory analyses are discussed. The complete R-code that was used for data manipulation and the creation of visualizations, can be found on [GitHub](https://github.com/JeroenDMulder/social-emotion-regulation). 

## Study design and data
In this section, the study design and data characteristics are summarized. The focus is on those aspects that are relevant for the statistical analyses described later. Participants in this study took part in the longitudinal twin study of the Leiden Consortium on Individual Development (L-CID). They were invited to participate in MRI sessions at three measurement occasions with approximately 2-year intervals, termed wave 1, 3, and 5, respectively. At each measurement occasion, the social network aggression task (SNAT) was used to measure four outcomes of interest, namely: 
- behavioral aggression, operationalized as noise blast durations aimed at aggressors (`noise`),
- stimulation of the right dorsolateral prefortonal cortex (`DLPFC`),
- stimulation of the anterior insula (`INS`), and
- stimulation of the medial prefrontal cortex (`MPFC`).

These outcomes were measured repeatedly after neutral and negative social feedback. In total, there were 20 neutral trials and 20 negative trials per measurement occasion, resulting in 3 sets of 40 repeated measures for individuals who completed measurements at all three waves. The behavioral measure `noise` is the length of a button press, that the participants presumed resulted in a loud noise blast for perceived aggressors. The brain measures `DLPFC`, `INS`, and `MPFC` were obtained from MRI scans. At wave 6, a social well-being questionnaire was filled in, consisting of 5 subscales: ten items from the Adolescent Wellbeing Paradigm (AWP), ten items from the World Health Organization Quality of Life Scale (WHOQoL), and three subscales (each five items) from the Harterâ€™s Self-Perception Profile for Adolescents (SPPA), specifically the subscales Social Competence (SC), Close Friendships (CF) and Global Self-worth (GS). All items were answered on a four-point Likert scale, with low scores indicating low social well-being and high scores indicating high social well-being.

<aside>The reader is referred to @Crone2020 for details on the Leiden Consortium on Individual Development. Details about the SNAT, and the preparation of MRI data can be found in the main paper</aside> 

## Methods
Discussion of the data and statistical analyses below is structured according to the three research aims:

1. To describe developmental trajectories of behavioral and brain responses of negative social feedback (i.e., *reactivity*) throughout childhood and emerging adolescence.
2. To estimate the associations between development in behavioral aggression regulation and development in neural responses to social rejection.
3. To estimate the relationship between development in social emotion regulation and social well-being in adolescence.

### Aim 1: Development of behavioral and brain reactivity
In this section, important characteristics of the `noise`, `DLPFC`, `INS`, and `MPFC` data are discussed first. Second, a Bayesian multilevel growth curve model is introduced. 

#### Data
Several characteristics of the data warrant attention. First, the data have a hierarchical structure, with repeated behavioral and brain *trials* (level 1) nested in measurement *waves* (level 2), which are nested in *individuals* (level 3), which are nested in *families* (level 4). The behavioral measurements `noise` have data at all 4 levels. For the brain measures `DLPFC`, `INS`, and `MPFC`, preprocessing of the MRI data already resulted in the difference between mean brain response for neutral feedback, and mean brain response for negative feedback, thereby eliminating the *trial* level. Second, there are individually-varying times of observation for the outcomes (see the reported age range per measurement wave in Table 1 of the paper). Hence, at each wave, participants might have been at a different stage in their development process. Third, Figure \@ref(fig:censoring) shows that the `noise` measurements have been censored from above, resulting from a time limit on the length of the button press (maximum of 3.5 seconds).

```{r censoring, echo=FALSE, warning=FALSE, layout="l-body-outset", fig.cap="Noise blast (seconds) per measurement occasion.", fig.width=6, fig.height=1.5}
read.csv("C:\\Users\\5879167\\surfdrive\\Research\\Applied - Social emotion regulation\\data\\202204_Research_EmotionRegulation_SNAT_Be.csv") %>% 
  naniar::replace_with_na_all(~ .x == -999) %>%
  dplyr::mutate(
    noise1 = T1_noiseblast / 1000, 
    noise2 = T2_noiseblast / 1000,
    noise3 = T3_noiseblast / 1000
  ) %>%
  dplyr::select(noise1, noise2, noise3) %>%
  tidyr::pivot_longer(
    cols = noise1:noise3,
    names_to = "wave",
    names_prefix = "noise",
    names_transform = list(wave = as.integer),
    values_to = "noise"
  ) %>%
  dplyr::mutate(
    censored = ifelse(noise == 3.500, 1, 0)
  ) %>%
  ggplot2::ggplot(aes(x = noise)) +
  ggplot2::geom_histogram() +
  ggplot2::facet_grid(. ~ wave) +
  ggplot2::theme_classic() +
  ggplot2::theme(text = element_text(size = 7))
```

Fourth, there is a fair amount of missing data. This is a combination of attrition (when individuals drop out of the study and do not contribute anymore to future measurements) and measurement error (e.g., when children move too much to get an MRI scan). Figure \@ref(fig:missing) shows the different missing data patterns. 

```{r missing, echo=FALSE, warning=FALSE, layout="l-body-outset", fig.cap="Missing data patterns.", fig.width=6, fig.height=3}
df_noise_wide <- read.csv("C:\\Users\\5879167\\surfdrive\\Research\\Applied - Social emotion regulation\\data\\202204_Research_EmotionRegulation_SNAT_Be.csv") %>%
  select(SubjectID, T1_noiseblast, T2_noiseblast, T3_noiseblast) %>%
  rename(id_orig = SubjectID) %>%
  naniar::replace_with_na_all(~ .x == -999) %>%
  group_by(id_orig) %>%
  summarise(
    noise1 = ifelse(all(is.na(T1_noiseblast)), NA, 1),
    noise2 = ifelse(all(is.na(T2_noiseblast)), NA, 1),
    noise3 = ifelse(all(is.na(T3_noiseblast)), NA, 1)
  )
  
df_INS_wide <- haven::read_spss("C:\\Users\\5879167\\surfdrive\\Research\\Applied - Social emotion regulation\\data\\202204_Research_EmotionRegulation_MRI.sav") %>%
  dplyr::select(SubjectID, ends_with("INS_Neg_Neut")) %>%
  dplyr::rename(id_orig = SubjectID,
                INS1 = T1_INS_Neg_Neut,
                INS2 = T2_INS_Neg_Neut,
                INS3 = T3_INS_Neg_Neut)

df_MPFC_wide <- haven::read_spss("C:\\Users\\5879167\\surfdrive\\Research\\Applied - Social emotion regulation\\data\\202204_Research_EmotionRegulation_MRI.sav") %>%
  dplyr::select(SubjectID, ends_with("MPFC_Neg_Neut")) %>%
  dplyr::rename(id_orig = SubjectID,
                MPFC1 = T1_MPFC_Neg_Neut,
                MPFC2 = T2_MPFC_Neg_Neut,
                MPFC3 = T3_MPFC_Neg_Neut)

df_wide <- haven::read_spss("C:\\Users\\5879167\\surfdrive\\Research\\Applied - Social emotion regulation\\data\\202204_Research_EmotionRegulation_MRI.sav") %>%
  dplyr::select(SubjectID, ends_with("DLPFC_Neg_Neut")) %>%
  dplyr::rename(id_orig = SubjectID,
                DLPFC1 = T1_DLPFC_Neg_Neut,
                DLPFC2 = T2_DLPFC_Neg_Neut,
                DLPFC3 = T3_DLPFC_Neg_Neut) %>%
  dplyr::right_join(df_INS_wide, by = "id_orig") %>%
  dplyr::right_join(df_MPFC_wide, by = "id_orig") %>%
  dplyr::right_join(df_noise_wide, by = "id_orig") %>%
  select(-id_orig)

rm("df_noise_wide", "df_INS_wide", "df_MPFC_wide")

ggmice::plot_pattern(df_wide) +
  ggplot2::theme(text = element_text(size = 7)) +
  ggplot2::scale_x_discrete(
    limits = c("DLPFC1", "INS1", "MPFC1", "noise1",
               "DLPFC2", "INS2", "MPFC2", "noise2",
               "DLPFC3", "INS3", "MPFC3", "noise3")
  )
```

Finally, Figure \@ref(fig:spaghetti) visualizes the brain data in spaghetti plots (for each brain outcome separately), which can be useful as an initial exploration of individual development in brain reactivity across time. The thick black line represent the average linear development in brain reactivity, and colored lines represent individual brain reactivity across time. From the plot it becomes clear that there are many differences in how individuals develop over time, and that *on average* development appears to be only minor.

```{r spaghetti, echo=FALSE, layout="l-screen-inset", fig.cap="Spaghetti plots of 3 brain outcomes."}
knitr::include_graphics("C:\\Users\\5879167\\Documents\\GitHub\\social-emotion-regulation\\figures\\p_brain.png")
```

#### Analyses
A Bayesian multilevel growth curve model was estimated for each outcome separately using the R-package `brms` [@Burkner2017] in R version ... [@RCoreTeam2022], and the statistical computation program Stan [@stan2022]. The Bayesian estimation framework was chosen because it can easily accommodate censoring by integrating out censored values [@Gelman2013]. Moreover, missing data can be imputed as part of the model fitting process under the assumption of missing at random (MAR) [@Burkner2017]. The multilevel framework was chosen because it treats the time of observation as data (rather than as a parameter, as in a latent growth curve model), and can therefore more easily handle individually-varying times of observations [@Mehta2000]. 

Let $noise_{fiwt}$ be the noise blast duration (in seconds) for an individual $i$ from family $f$, at measurement wave $w$ and trial $t$. At level 1, the model is given by
$$
noise_{fiwt} = \beta_{0fiw} + \beta_{1fiw} \; x_{fiwt} + e_{fiwt}. 
$$
$x_{fiwt}$ is the condition (type of feedback, with 0 = neutral, negative = 1), $\beta_{0fiw}$ is a random mean representing noise blast duration for neutral feedback for individual $i$ from family $f$ at wave $w$, $\beta_{1fiw}$ is a random slope representing the difference, or *reactivity*, between the neutral and negative condition for individual $i$ from family $f$ at wave $w$, and $e_{fiwt}$ represents the residuals. 

At level 2, the model is specified as
$$
\beta_{0fiw} = \gamma_{00fi} + u_{0fiw},\\
\beta_{1fiw} = \gamma_{10fi} + \gamma_{11fi} \; a_{fiw} + \gamma_{12fi} \; a_{fiw}^{2} + u_{1fiw},
$$
where $\gamma_{00fi}$ is a random intercept representing noise blast for the neutral condition, and $u_{0fiw}$ is the random component with variance $Var[u_{0fiw}]$, representing a family-, individual-, and wave-specific deviation from $\gamma_{00fi}$. To describe development in reactivity over time, $\beta_{1fiw}$ is predicted from age $a_{fiw}$, and age-squared $a^{2}_{fiw}$. The predictor is grand-mean centered at 0 to prevent issues with multicollinearity, such that $a_{fiw} = 0$ now represents an age of approximately 9 years and 9 months. The coefficients $\gamma_{10fi}$, $\gamma_{11fi}$, and $\gamma_{12fi}$ are the growth components of interest, describing the mean reactivity, linear development in reactivity, and quadratic development in reactivity of individual $i$ from family $f$ at 9 years and 9 months of age, respectively. $u_{1fiw}$ is a random component with variance $Var[u_{1fiw}]$, representing a family-, individual-, and wave-specific deviations from the expected $\beta_{1fiw}$.

At level 3, the model is specified as 
$$
\gamma_{00fi} = \delta_{0} + v_{0fi},\\
\gamma_{10fi} = \delta_{1f} + v_{1fi},\\
\gamma_{11fi} = \delta_{2f} + v_{2fi},\\
\gamma_{12fi} = \delta_{3f} + v_{3fi},
$$
where $\delta_{0f}$ represents the mean noise blast of family $f$ for the neutral condition, and $v_{0fi}$ represents the individual-specific deviation from $\delta_{00}$ with variance $Var[v_{0fi}]$. $\delta_{1f}$, $\delta_{2f}$, and $\delta_{3f}$ represent the family means of the growth components described on level 2, and $v_{1fi}$, $v_{2fi}$, and $v_{3fi}$ represent individual-specific (also referred to as within-family) deviations from these means with variances $Var[v_{1fi}]$, $Var[v_{2fi}]$, and $Var[v_{3fi}]$. 

Finally, at level 4, the model is given by
$$
\delta_{0f} = \theta_{0} + z_{0f},\\
\delta_{1f} = \theta_{1} + z_{1f},\\
\delta_{2f} = \theta_{2} + z_{2f},\\
\delta_{3f} = \theta_{3} + z_{3f}.
$$
where $\theta_{0}$ is the grand mean (across families, individuals, waves, and trials) of noise blast for the neutral condition. $\theta_{1}$, $\theta_{2}$, and $\theta_{3}$ are the grand means of the growth components. $z_{1f}$, $z_{2f}$, and $z_{3f}$ are family-specific differences herein, with variances $Var[z_{1f}]$, $Var[z_{2f}]$, and $Var[z_{3f}]$. In total, 15 parameters are estimated, namely 4 fixed effects and 4 random effect variances at level 4, 4 random effect variances at level 3, 2 random effect variances at level 2, and 1 residual variance at level 1. 

Missing data were imputed as part of model fitting. Due to the setup of the study (with a planned 2 year interval between subsequent measurement waves), missing values for age $a^{mis}_{fiw}$ could be predicted from the individual's age at the first measurement wave `ageW1c` and the wave number. Missing values for age-squared $a^{2, mis}_{fiw}$ could then be created simply by squaring $a^{mis}_{fiw}$. This resulted in the exclusion of a single family (2 individuals) from the sample, who had missing values at their first measurement wave. For the outcome, missing values were predicted from feedback condition $X$, age $A$, and age-squared $A^{2}$. For this procedure to work well, missing at random (MAR) has to be assumed, implying that the degree of missingness only depends on the observed data. While, the plausibility of this assumption can be questioned, it is a weaker assumption than missing completely at random (MCAR), which would be assumed when the missing values were simply deleted from the data [@Gelman2013]. 

For the brain data, mean reactivity is already available from the preprocessing of the MRI data. Therefore, in the model above, the trial level is removed, as well as the equation for $\beta_{0fiw}$ at level 2. The interpretation of the remaining parameters, and the procedure used to impute for missing values, are equivalent. 

R-code for model fitting is printed below, for each outcome in a separate tab. `brms` allows for models to be specified using `lme4`-like syntax. The `mi()` wrapper around variables denotes that missing values are imputed. For each outcome, `iter = 4000` values were sampled from the posterior distribution, of which the first `warmup = 2000` were discarded. `chains = 2` chains were used, and convergence was assessed using the split-$\hat{R}$ value [@Gelman2013]. Only every `thin = 4`$^{th}$ simulation draw was kept to keep model size manageable, resulting in a total of 1000 posterior simulation draws. `Stan`'s default uninformative priors were used because no independent prior information was available on the development of behavioral and brain emotion regulation as measured using the SNAT. 

```{r panelset, echo=FALSE}
xaringanExtra::use_panelset()
```

::: {.panelset}

::: {.panel}

#### `noise` {.panel-name}
Noise blast measurements have a lower limit of 0, and are restricted from above at 3.5 seconds. In theory, this information could be included in the model in the form of a bounded prior on the range of values that the fixed effects $\theta$ could take on. However, the `brms` manual states that such a procedure is rarely usefull, and hence default uninformative priors were used. The `cens()` function was used to denote which values were censored. Two models where fitted. The first assumed that the outcome was Gaussian distributed. Second, given the complexity of this 4-level model, and the restricted range of `noise`, a model assuming a *t*-distributed outcome was fitted as well to allow for more robust inference [@Gelman2013]. 

```{r noise, eval=FALSE}
# Gaussian response distribution
f_noise_gaus <- 
  bf(noise | cens(censored) + mi() ~ 1 + con + con:mi(agec) + con:mi(agec2) + 
       (1 + con | fam/id/wave) + (-1 + con:mi(agec) + con:mi(agec2) | fam/id)) + 
  gaussian() + 
  bf(agec | mi() ~ -1 + ageW1c + wave0) +
  bf(agec2 | mi() ~ -1 + ageW1c2 + ageW1c_wave0 + wave02)

m_noise_gaus <- brm(f_noise_gaus,
  data = df_noise,
  warmup = 2000,
  iter = 4000,
  chains = 2,
  init = "random",
  cores = 2,
  thin = 4,
  seed = 20221005,
  control = list(adapt_delta = 0.85)
)

# Student-t response distribution
f_noise_stud <- 
  bf(noise | cens(censored) + mi() ~ 1 + con + con:mi(agec) + con:mi(agec2) + 
       (1 + con | fam/id/wave) + (-1 + con:mi(agec) + con:mi(agec2) | fam/id)) + 
  student() + 
  bf(agec | mi() ~ -1 + ageW1c + wave0) +
  bf(agec2 | mi() ~ -1 + ageW1c2 + ageW1c_wave0 + wave02)

m_noise_stud <- brm(f_noise_stud,
  data = df_noise,
  warmup = 2000,
  iter = 4000,
  chains = 2,
  init = "random",
  cores = 2,
  thin = 4,
  seed = 20221005,
  control = list(adapt_delta = 0.88)
)
```

:::

::: {.panel}

#### `DLPFC` {.panel-name}

```{r DLPFC, eval=FALSE}
f_DLPFC_3L <- 
  bf(DLPFC | mi() ~ 1 + mi(agec) + mi(agec2) + (1 + mi(agec) + mi(agec2) | fam/id)) + 
  gaussian() +
  bf(agec | mi() ~ -1 + ageW1c + wave0) +
  bf(agec2 | mi() ~ -1 + ageW1c2 + ageW1c_wave0 + wave02)

m_DLPFC_3L <- brm(f_DLPFC_3L,
  data = df_brain,
  warmup = 2000,
  iter = 4000,
  chains = 2,
  init = "random", 
  cores = 2,
  thin = 4,
  seed = 20221005
)
```

:::

::: {.panel}

#### `INS` {.panel-name}

```{r INS, eval=FALSE}
f_INS_3L <- 
  bf(INS | mi() ~ 1 + mi(agec) + mi(agec2) + (1 + mi(agec) + mi(agec2) | fam/id)) + 
  gaussian() +
  bf(agec | mi() ~ -1 + ageW1c + wave0) +
  bf(agec2 | mi() ~ -1 + ageW1c2 + ageW1c_wave0 + wave02)

m_INS_3L <- brm(f_INS_3L,
  data = df_brain,
  warmup = 2000,
  iter = 4000,
  chains = 2,
  init = "random", 
  cores = 2,
  thin = 4,
  seed = 20221005
)
```

:::

::: {.panel}

#### `MPFC` {.panel-name}

```{r MPFC, eval=FALSE}
f_MPFC_3L <- 
  bf(MPFC | mi() ~ 1 + mi(agec) + mi(agec2) + (1 + mi(agec) + mi(agec2) | fam/id)) + 
  gaussian() + 
  bf(agec | mi() ~ -1 + ageW1c + wave0) +
  bf(agec2 | mi() ~ -1 + ageW1c2 + ageW1c_wave0 + wave02)

m_MPFC_3L <- brm(f_MPFC_3L,
  data = df_brain,
  warmup = 2000,
  iter = 4000,
  chains = 2,
  init = "random", 
  cores = 2,
  thin = 4,
  seed = 20221005
)
```

:::

:::

#### Deviations from preregistration
The preregistration stated that correlations between the random coefficients at each level would be estimated. However, due to low level-specific sample sizes, this was not statistically feasible, and these coefficients were excluded from the model. 

### Aims 2 and 3: Associations between development and social well-being
These analyses described here are related to both aims 2 and 3. For aim 2, associations between the growth components of the 4 behavioral and brain outcomes were investigated. For aim 3, estimated individual-level growth components were used to predict social well-being at wave 6. In this section, I first discus how growth components for each individual are extracted from the growth curve models. Second, a structural equation model is introduced to estimate correlations between these growth components (aim 2), and predict social well-being during adolescence (aim 3).

#### Data
The results from the fitted growth curve models are based on 1000 draws of the poster distribution for each parameter, both fixed effects and random effects. Therefore, at each iteration, the sampled fixed effects and individually drawn random effects can be extracted from the model and used compute personalized growth components. Specifically, for an individual $i$ from family $f$, and given a specific iteration, the growth components are computed as
$$
\gamma_{10fi} = \theta_{1} + z_{1f} + v_{1if}, \\
\gamma_{11fi} = \theta_{2} + z_{2f} + v_{2if}, \\
\gamma_{12fi} = \theta_{3} + z_{3f} + v_{3if}.
$$
Computing these 3 parameters, for each of the 4 outcomes, and for each iteration, results in 1000 data sets of $4 \times 3 = 12$ personalized growth components. These serve as input for predicting social well-being. 

Social well-being data consists of 35 items, belonging to 1 of 5 subscales. The data were preprocessed by computing factor scores for each subscale by taking the mean of the respective items (as instructed in the subscale manuals). 

#### Analyses
Structural equation modeling was used to estimate the relations between the development behavioral and brain reactivity, as well as later social well-being. The R-package *lavaan* version 0.6.12 was used to fit SEM models [@Rosseel2012]. A multiple regression model is specified with social well-being as the outcome, and the growth components for each outcome as predictors. Social well-being is measured by a one-factor model with the subscale scores as the indicators (the factor loading for the first subscale is fixed at 1). The estimated regression coefficients then represent the relationship between development in social emotion regulation and social well-being in adolescence. The predictors are allowed to covary freely with each other to investigate the associations between development in reactivity of behavioral and brain outcomes. `lavaan` model syntax can be found below.

```{r lavaan, eval=FALSE, layout="l-body-outset"}
m_regression <- '
  # 1-factor model for social well-being
  well =~ co + who + sc + cf + gs  
  
  # Measurement error variances
  co ~~ co 
  who ~~ who 
  sc ~~ sc
  cf ~~ cf
  gs ~~ gs
  
  # Predict social well-being
  well ~ gamma10_INS + gamma11_INS + gamma12_INS +
         gamma10_DLPFC + gamma11_DLPFC + gamma12_DLPFC +
         gamma10_MPFC + gamma11_MPFC + gamma12_MPFC +
         gamma10_noise + gamma11_noise + gamma12_noise
  
  # Residual variance
  well ~~ well
  
  # Variances of predictors
  gamma10_INS ~~ gamma10_INS
  gamma11_INS ~~ gamma11_INS
  gamma12_INS ~~ gamma12_INS
  
  gamma10_DLPFC ~~ gamma10_DLPFC
  gamma11_DLPFC ~~ gamma11_DLPFC
  gamma12_DLPFC ~~ gamma12_DLPFC
  
  gamma10_MPFC ~~ gamma10_MPFC
  gamma11_MPFC ~~ gamma11_MPFC
  gamma12_MPFC ~~ gamma12_MPFC
  
  gamma10_noise ~~ gamma10_noise
  gamma11_noise ~~ gamma11_noise
  gamma12_noise ~~ gamma12_noise
  
  # Covariances among predictors
  gamma10_INS ~~ gamma11_INS + gamma12_INS + gamma10_DLPFC + gamma11_DLPFC + gamma12_DLPFC + 
                 gamma10_MPFC + gamma11_MPFC + gamma12_MPFC + gamma10_noise + gamma11_noise + 
                 gamma12_noise
  gamma11_INS ~~ gamma12_INS + gamma10_DLPFC + gamma11_DLPFC + gamma12_DLPFC + gamma10_MPFC + 
                 gamma11_MPFC + gamma12_MPFC + gamma10_noise + gamma11_noise + gamma12_noise
  gamma12_INS ~~ gamma10_DLPFC + gamma11_DLPFC + gamma12_DLPFC + gamma10_MPFC + gamma11_MPFC + 
                 gamma12_MPFC + gamma10_noise + gamma11_noise + gamma12_noise
  
  gamma10_DLPFC ~~ gamma11_DLPFC + gamma12_DLPFC + gamma10_MPFC + gamma11_MPFC + gamma12_MPFC + 
                   gamma10_noise + gamma11_noise + gamma12_noise
  gamma11_DLPFC ~~ gamma12_DLPFC + gamma10_MPFC + gamma11_MPFC + gamma12_MPFC + gamma10_noise + 
                   gamma11_noise + gamma12_noise
  gamma12_DLPFC ~~ gamma10_MPFC + gamma11_MPFC + gamma12_MPFC + gamma10_noise + gamma11_noise + 
                   gamma12_noise
  
  gamma10_MPFC ~~ gamma11_MPFC + gamma12_MPFC + gamma10_noise + gamma11_noise + gamma12_noise
  gamma11_MPFC ~~ gamma12_MPFC + gamma10_noise + gamma11_noise + gamma12_noise
  gamma12_MPFC ~~ gamma10_noise + gamma11_noise + gamma12_noise
  
  gamma10_noise ~~ gamma11_noise + gamma12_noise
  gamma11_noise ~~ gamma12_noise
' 
```

To carry over the uncertainty of the personalized growth component estimates from the Bayesian growth curve models, the SEM model was fitted to each of the 1000 data sets using the R-package *semTools* [@Jorgensen2022]. Point and standard error estimates were pooled according to rules by @Rubin1987. 

## Results

### Aim 1: Development of behavioral and brain reactivity
In this section, model fit is evaluated using a posterior predictive check, and the results are presented.

::: {.panelset}

::: {.panel}

#### `noise` {.panel-name}

The posterior predictive checks (ppc) of two models for `noise` are shown in Figure \@ref(fig:noise-ppc): The left panel is a ppc-plot from a model assuming a Gaussian-distributed outcome; the right panel is a ppc-plot from a model assuming a *Student t*-distributed outcome. The comparison shows that using a *t*-distribution, the model is better able to capture the kurtosis in the observed density, and that the modes of the posterior draws better align with the peak of the observed data. Therefore, the model assuming a *t*-distributed outcome is selected for further interpretation. 

```{r noise-ppc, echo=FALSE, fig.cap="Posterior predictive checks (ppc) for the outcome noise. The model underlying the left plot assumes a normally-distributed outcome; the model underlying the right plot assumes a t-distributed outcome.", fig.width=6, fig.height=3}
knitr::include_graphics("figures\\ppc-noise.png")
```

The right panel of Figure \@ref(fig:noise-ppc) shows that the model predicts numerous values higher than 3.5. To assess how well the proportion of *predicted* values higher than 3.5 represents the proportion of *observed* censored values, a third posterior predictive check was performed. Figure \@ref(fig:noise-ppc-rcens) shows that the model underestimates the proportion of noise blasts longer 3.5 seconds. However, in absolute sense, this misfit is small enough to move forward with this model. 

```{r noise-ppc-rcens, echo=FALSE, fig.cap="Posterior predictive checks (ppc) for the outcome noise from two different models. The model from the left panel assumes a normally-distributed outcome. The model from the right panel assumes a t-distributed outcome.", fig.width=6, fig.height=3}
knitr::include_graphics(".\\figures\\ppc-noise-rcens.png")
```

Results for the `noise` model (with *t*-distributed response) are shown below. The fixed effects estimated $\hat{\theta}_{1}$, $\hat{\theta}_{2}$, and $\hat{\theta}_{3}$ can be found under `Population-Level Effects` as `noise_con`, `noise_con:miagec`, and `noise_con:miagec2`, respectively. Standard deviation estimates of random effects at the family-level (i.e., $z$ parameters) are reported under `~fam`, standard deviation estimations of random effects at the individual-level (i.e., $v$ parameters) are reported under `~fam:id`, and standard deviation estimates of random effecst at the wave-level (i.e., $u$ parameters) are reported under `fam:id:wave`.

```{r noise-load, echo=FALSE, layout="l-body-outset"}
knitr::include_graphics(".\\figures\\brms-noise.png")
```

The $\hat{R}$-value for the random within-family effect of the mean noise reactivity $SD(v_{1})$ is not below the recommended value 1.05, indicating that the posterior sampling chains have not converged sufficiently yet to a stable solution. Moreover, the bulk effective sample size `Bulk_ESS` for this parameter, as well as for the random between-family effect of the mean noise reactivity $SD(z_{1})$, is (far) below the recommended number of effective samples (100 times the number of chains). This speaks to the complexity of the model, especially in relation to the relatively low sample sizes at the family- and individual-level. 

The fixed effects show that there is 95% certainty that expected reactivity in `MPFC` at 9 years and 9 months of age $\theta_{1}$ lies between $0.52$ and $1.20$. The random effects imply that there are significant differences *between* individuals within families herein, $SD(z_{1}) = [0.13 - 1.62]$, as well as significant *within* family differences, $SD(v_{1}) = [0.03 - 1.37]$. Linear development of `MPFC` at mean age $\theta_{2}$ lies between  $-0.17$ and $0.10$. In contrast to the response variables `DLPFC` and `MPFC`, the random effect estimates suggests no differences between families in linear development, $SD(z_{2}) = [0.00 - 0.31]$, but only individual-level differences within families herein, $SD(v_{2}) = [0.01 - 0.56]$. The quadratic development of `MPFC` at mean age $\theta_{3}$ is estimated to lie between $-0.01$ and $0.13$, and no significant differences between families, $SD(z_{3}) = [0.00 - 0.27]$, or within families, $SD(v_{3}) = [0.00 - 0.23]$, have been found. 

```{r noise-predicted, echo=FALSE, fig.width=3, fig.height=3, fig.cap="Predicted development in behavioral reactivity."}
knitr::include_graphics(".\\figures\\plot_noise_predicted.png")
```

:::

::: {.panel}

#### `DLPFC` {.panel-name}

Results for the `DLPFC` model are shown below. 

```{r DLPFC-res, echo=FALSE, layout="l-body-outset"}
knitr::include_graphics(".\\figures\\brms-DLPFC.png")
```

The $\hat{R}$-values are below the recommended 1.05, indicating adequate mixing of the posterior sampling chains. The posterior predictive checks in Figure \@ref(fig:DLPFC-ppc) below imply that the model shows adequate fit for both the imputed values of age and age$^{2}$, as well as for the response variable `DLPFC`.  

```{r DLPFC-ppc, echo=FALSE, fig.cap="Posterior predictive check for the outcome DLPFC, and imputed values of age and age-squared.The dark blue line represents observed data, and the light blue lines represent model predicted (replicated) values.", fig.width=6, fig.height=3}
knitr::include_graphics("figures\\ppc-DLPFC.png")
```

The fixed effects show that there is 95% certainty that expected reactivity in `DLPFC` at 9 years and 9 months of age $\theta_{1}$ lies between $-0.65$ and $-0.09$. The random effects imply that there are significant *between* families differences herein, $SD(z_{1}) = [0.01 - 0.84]$, as well as significant *within* family differences, $SD(v_{1}) = [0.02 - 0.97]$. Linear development of `DLPFC` at mean age $\theta_{2}$ lies between  $-0.14$ and $0.11$. Again, the random effect estimates suggests differences between families herein, $SD(z_{2}) = [0.01 - 0.43]$, as well as within families, $SD(v_{2}) = [0.02 - 0.53]$. The quadratic development of `DLPFC` at mean age $\theta_{3}$ is estimated to lie between $-0.02$ and $0.11$, and no significant differences between families, $SD(z_{3}) = [0.00 - 0.16]$, or within families, $SD(v_{3}) = [0.00 - 0.17]$, have been found. 

These results are visualized in Figure \@ref(fig:DLPFC-predicted). The thick black line represents predicted development in `DLPFC` reactivity over time based on the fixed effects estimates. The lighter black lines denote the uncertainty around this estimated development. The red dotted line denotes the mean age of the sample. 

```{r DLPFC-predicted, echo=FALSE, fig.width=3, fig.height=3, fig.cap="Predicted development in DLPFC reactivity."}
knitr::include_graphics(".\\figures\\plot_DLPFC_predicted.png")
```

:::

::: {.panel}

#### `INS` {.panel-name}

Results for the `INS` model are shown below:

```{r INS-res, echo=FALSE, layout="l-body-outset"}
knitr::include_graphics(".\\figures\\brms-INS.png")
```

The estimation procedure resulted in 1 warning about a single divergent transition after the warmup phase. Divergences can occur when the sampling procedure has difficulties exploring the target posterior distribution, which is an issue when the curvature of the posterior is highly variable. However, because there is only a single divergence, and there are good $\hat{R}$ values, and effective sample sizes for the bulk and tail of the distribution, there is enough confidence in the resulting posterior to move forward. 

The posterior predictive checks in Figure \@ref(fig:INS-ppc) below imply that the model shows adequate fit for both the imputed values of age and age$^{2}$, as well as for the response variable `INS`.  

```{r INS-ppc, echo=FALSE, fig.cap="Posterior predictive check for the outcome INS, and imputed values of age and age-squared.", fig.width=6, fig.height=3}
knitr::include_graphics("figures\\ppc-INS.png")
```

The fixed effects show that there is 95% certainty that expected reactivity in `INS` at 9 years and 9 months of age $\theta_{1}$ lies between $0.42$ and $1.03$. The random effects imply that there are significant differences *between* individuals within families herein, $SD(z_{1}) = [0.01 - 0.81]$, as well as significant *within* family differences, $SD(v_{1}) = [0.02 - 1.01]$. Linear development of `INS` at mean age $\theta_{2}$ lies between  $-0.29$ and $-0.02$. Again, the random effect estimates suggests differences between families herein, $SD(z_{2}) = [0.01 - 0.35]$, as well as within families, $SD(v_{2}) = [0.03 - 0.66]$. The quadratic development of `INS` at mean age $\theta_{3}$ is estimated to lie between $-0.01$ and $0.13$, and no significant differences between families, $SD(z_{3}) = [0.00 - 0.14]$, or within families, $SD(v_{3}) = [0.00 - 0.17]$, have been found. 

These results are visualized in Figure \@ref(fig:INS-predicted). The thick black line represents predicted development in `INS` reactivity over time based on the fixed effects estimates. The lighter black lines denote the uncertainty around this estimated development. The red dotted line denotes the mean age of the sample. 

```{r INS-predicted, echo=FALSE, fig.width=3, fig.height=3, fig.cap="Predicted development in INS reactivity."}
knitr::include_graphics(".\\figures\\plot_INS_predicted.png")
```


:::

::: {.panel}

#### `MPFC` {.panel-name}

Results for the `MPFC` model are shown below:

```{r MPFC-res, echo=FALSE, layout="l-body-outset"}
knitr::include_graphics(".\\figures\\brms-MPFC.png")
```

The estimation procedure resulted in 1 warning about a single divergent transition after the warmup phase. Divergences can occur when the sampling procedure has difficulties exploring the target posterior distribution, which is an issue when the curvature of the posterior is highly variable. However, because there is only a single divergence, and there are good $\hat{R}$ values, and effective sample sizes for the bulk and tail of the distribution, there is enough confidence in the resulting posterior to move forward. 

The posterior predictive checks in Figure \@ref(fig:MPFC-ppc) below imply that the model shows adequate fit for both the imputed values of age and age$^{2}$, as well as for the response variable `MPFC`.  

```{r MPFC-ppc, echo=FALSE, fig.cap="Posterior predictive check for the outcome MPFC, and imputed values of age and age-squared.", fig.width=6, fig.height=3}
knitr::include_graphics("figures\\ppc-MPFC.png")
```

The fixed effects show that there is 95% certainty that expected reactivity in `MPFC` at 9 years and 9 months of age $\theta_{1}$ lies between $0.52$ and $1.20$. The random effects imply that there are significant differences *between* individuals within families herein, $SD(z_{1}) = [0.13 - 1.62]$, as well as significant *within* family differences, $SD(v_{1}) = [0.03 - 1.37]$. Linear development of `MPFC` at mean age $\theta_{2}$ lies between  $-0.17$ and $0.10$. In contrast to the response variables `DLPFC` and `MPFC`, the random effect estimates suggests no differences between families in linear development, $SD(z_{2}) = [0.00 - 0.31]$, but only individual-level differences within families herein, $SD(v_{2}) = [0.01 - 0.56]$. The quadratic development of `MPFC` at mean age $\theta_{3}$ is estimated to lie between $-0.01$ and $0.13$, and no significant differences between families, $SD(z_{3}) = [0.00 - 0.27]$, or within families, $SD(v_{3}) = [0.00 - 0.23]$, have been found. 

These results are visualized in Figure \@ref(fig:MPFC-predicted). The thick black line represents predicted development in `MPFC` reactivity over time based on the fixed effects estimates. The lighter black lines denote the uncertainty around this estimated development. The red dotted line denotes the mean age of the sample. 

```{r MPFC-predicted, echo=FALSE, fig.width=3, fig.height=3, fig.cap="Predicted development in MPFC reactivity."}
knitr::include_graphics(".\\figures\\plot_MPFC_predicted.png")
```

:::

:::


### Aims 2 and 3: Associations between development and social well-being
The fitted SEM model is saturated (there are 0 degrees of freedom) and hence model fit is perfect. Analyses on 10 data sets did not result in convergence, such that the pooled results below are based on 990 data sets. In the output, `gamma10_`, `gamma11_` and `gamma12_` represent $\hat{\gamma}_{10}$, $\hat{\gamma}_{11}$, and $\hat{\gamma}_{12}$, respectively, with the text after the underscore `_` denoting the outcome that the growth component belongs to.

```{r phaseII, eval=TRUE, echo=FALSE}
load("C:\\Users\\5879167\\Documents\\GitHub\\social-emotion-regulation\\models\\out_phaseII.Rds")
summary(out_phaseII)
```

#### Aim 2: Associations between development
Covariances between the estimated growth components of reactivity is reported under `Covariances:`. Out of 66 estimated covariances, only the covariance between the expected `MPFC` reactivity at mean age is significantly and negatively related to the quadratic effect of `MPFC` at mean age. This implies that individuals with a higher expected `MPFC` at approximately 9 years and 9 months of age also show a less curvilinear (i.e., more linear) development at that age. 

#### Aim 3: Predicting social well-being
A unidimensional social well-being factor was constructed from 5 subscale means. The factor loadings are reported under `Latent Variables:` with the factor loading for the subscale `co` fixed at 1. Unique variances (measurement error) of each subscale are reported under `Variances:`. Estimated regression coefficients for prediction of the social well-being factor are reported under `Regressions:`. Results show that the estimated individual growth components do not significantly predict social well-being. 

## Exploratory analyses
In addition to the preregistered analyses, three sets of exploratory analyses have been performed:

1. A comparison with analyses in @Achterberg2020 to explain differences in results.
2. A reanalysis of the data with growth components predicting social well-being *subscales*.
3. A reanalysis of the data with insignificant quadratic effects omitted for analyses related to aims 2 and 3.

### 1. Comparison with @Achterberg2020
WILLEN WE DIT INCLUDEREN HIER, OF IS HET MEER VOOR ONSZELF? 

### 2. Predicting social well-being subscales
Compared to the preregistered analyses, the following changes were made. Rather than predicting a unidimensional social-well being factor, associations between the growth components and social well-begin subscales were estimated using SEM. Results are reported below. Analyses on 3 data sets did not result in convergence, such that the pooled estimates are based on 997 data sets. 

```{r exploratoryIII, eval=TRUE, echo=FALSE}
load("C:\\Users\\5879167\\Documents\\GitHub\\social-emotion-regulation\\models\\out_exploratoryIII.Rds")
summary(out_exploratoryIII)
```

Regarding aim 2, two covariances between growth components were estimated to be significant. First, the covariance between the expected INS reactivity at mean age $\gamma_{10}^{INS}$ and linear development herein at mean age $\gamma_{11}^{INS}$ is estimated to be -0.121, implying that individuals with higher expected INS reactivity at mean age show a more negative linear development herein at mean age. This result is different (in terms of significance) compared to the preregistered analyses. Second, the covariance between expected MPFC reactivity at mean age $\gamma_{10}^{MPFC}$ and the quadratic development herein at mean age $\gamma_{12}^{MPFC}$ is estimated to be -0.111, implying that individuals with higher expected MPFC reactivity at mean age also show a more negative quadratic development herein at mean age. This result (in terms of significance) is in line with the preregistred analyses. 

Regarding aim 3, none of the growth components show a significant relationship with social well-being subscales. 

### 3. Omitting insignificant quadratic effects
Compared to the preregistered analyses, the following changes were made. For each growth curve model, random effects of the quadratic effect of time `agec2` were deleted if their standard deviations did not deviate from 0. Similarly, the fixed effect $\theta_{3}$ was also omitted when the estimated 95% credible intervals contained 0. The adjusted models were reestimated, and individual growth components were extracted. These were used as predictors of the individual subscales of social well-being. This exploratory analysis was deemed interesting because the reduced complexity of the SEM-model has more power to detect relations between growth components and social well-being subscales. 

For behavioral outcome `noise`, only the random effects were deleted. This implies that the interpretation of the parameters is largely the same as for the preregistered analyses above, with the exception that $\gamma_{12}$ does not vary across families and individuals. For the brain outcomes, both fixed and random effects of `agec2` were deleted from the model. Therefore, $\gamma_{11}$ is not particular to the mean age anymore, instead representing linear development across all ages. The intercept $\gamma_{10}$ can be interpreted as with the preregistered analyses above. 

Results of the adjusted growth curve models are reported below per outcome. 

::: {.panelset}

::: {.panel}

#### `noise` {.panel-name}

Results for the `noise` model (with *t*-distributed response) are shown below. 

```{r noise-resII, echo=FALSE, layout="l-body-outset"}
knitr::include_graphics(".\\figures\\brms-noise-exploratoryII.png")
```


:::

::: {.panel}

#### `DLPFC` {.panel-name}

Results for the `DLPFC` model are shown below. 

```{r DLPFC-resII, echo=FALSE, layout="l-body-outset"}
knitr::include_graphics(".\\figures\\brms-DLPFC-exploratoryII.png")
```


:::

::: {.panel}

#### `INS` {.panel-name}

Results for the `INS` model are shown below:

```{r INS-resII, echo=FALSE, layout="l-body-outset"}
knitr::include_graphics(".\\figures\\brms-INS-exploratoryII.png")
```

:::

::: {.panel}

#### `MPFC` {.panel-name}

Results for the `MPFC` model are shown below:

```{r MPFC-resII, echo=FALSE, layout="l-body-outset"}
knitr::include_graphics(".\\figures\\brms-MPFC-exploratoryII.png")
```

:::

:::

Next, estimated individual intercepts and linear development for four outcomes were used to predict social well-being subscales in a SEM-model, and results are reported below. Analyses on 3 data sets did not result in convergence, such that the pooled estimates are based on 997 data sets. 

```{r lavaanII, eval=TRUE, echo=FALSE}
load("C:\\Users\\5879167\\Documents\\GitHub\\social-emotion-regulation\\models\\out_exploratoryII.Rds")
summary(out_exploratoryII)
```

Regarding aim 2, similar to the preregistered analyses, a significant covariance was found between expected INS reactivity at mean age $\gamma_{10}^{INS}$ and linear development herein $\gamma_{11}^{INS}$. Other covariances between growth components did not reach significance. 

Regarding aim 3, none of the growth components show a significant relationship with social well-being subscales. 